import t from"roughjs/bin/rough";import e from"tinycolor2";import{SVGPathData as n,SVGPathDataTransformer as r,encodeSVGPath as s}from"svg-pathdata";import{Random as o}from"roughjs/bin/math";var i;function a(t){if(void 0!==t.children)return t.children;let e,n=0;const r=t.childNodes,s=[];for(;e=r[n++];)1===e.nodeType&&s.push(e);return s}function l(t){const e=t.parentNode;return e&&e.nodeType===Node.ELEMENT_NODE?e:null}function u(t,e){for(;e.firstChild;)t.append(e.firstChild);return t}function c(t){if(null===t)return null;const e=/url\('#?(.*?)'\)/.exec(t)||/url\("#?(.*?)"\)/.exec(t)||/url\(#?(.*?)\)/.exec(t);return e&&e.length>1?e[1]:null}!function(t){t[t.SVG=0]="SVG",t[t.CANVAS=1]="CANVAS"}(i||(i={}));const h="data-sketchy-clip-path",f=/[acsqt]/i;function g(t){if(t.svgSketchDefs)return t.svgSketchDefs;const e=t.svgSketch,n=document.createElementNS("http://www.w3.org/2000/svg","defs");return e.childElementCount>0?e.insertBefore(n,e.firstElementChild):e.appendChild(n),t.svgSketchDefs=n,n}function m(t){const e=t.getAttribute("points");if(!e)return[];let n;n=e.indexOf(" ")>0?/\s+/g:/,/g;const r=e.split(n),s=[];for(let t=0;t<r.length;t++){const e=r[t],n=e.split(",");if(2===n.length)s.push({x:parseFloat(n[0]),y:parseFloat(n[1])});else{const n=t+1;n<r.length&&(s.push({x:parseFloat(e),y:parseFloat(r[n])}),t=n)}}return s}function d(t,e,n){let r=n;const s=e.getAttribute(h),o=t.pencilFilter&&"text"!==e.tagName;if(!("g"===r.tagName&&0===r.attributes.length)&&(s||o)){const t=document.createElementNS("http://www.w3.org/2000/svg","g");t.appendChild(r),r=t}s&&(r.setAttribute("clip-path",`url(#${s})`),e.removeAttribute(h)),o&&r.setAttribute("filter","url(#pencilTextureFilter)"),t.svgSketch.appendChild(r)}function p(t,e,n){return f.test(e)&&(n=n?Object.assign(Object.assign({},n),{preserveVertices:!0}):{preserveVertices:!0}),t.rc.path(e,n)}function x(t,e,n,r){let s;if(s=r?e.getAttribute(n):getComputedStyle(e)[n]||e.getAttribute(n),!s){let s=l(e);const o=r;let i=o;if(o&&o.referenced===e&&(s=o.root,i=o.parentContext),!s||s===t.sourceSvg)return;return x(t,s,n,i)}return s}function b(t,e,n,r){let s;if(s=r?e.getAttribute("opacity"):getComputedStyle(e).opacity||e.getAttribute("opacity"),s){let t=1;t=-1!==s.indexOf("%")?Math.min(1,Math.max(0,parseFloat(s.substring(0,s.length-1))/100)):Math.min(1,Math.max(0,parseFloat(s))),n*=t}let o=l(e);const i=r;let a=i;return i&&i.referenced===e&&(o=i.root,a=i.parentContext),o&&o!==t.sourceSvg?b(t,o,n,a):n}function v(t,e,n){const{fillId:r,strokeId:s}=function(t,e){function n(n){const r=e.getAttribute(n);if(r&&-1!==r.indexOf("url")){const e=c(r);if(e){if(t.idElements[e]instanceof SVGPatternElement)return e}}return null}return{fillId:n("fill"),strokeId:n("stroke")}}(t,e);if(null!==r||null!==s){const o=n();o.setAttribute("fill",null!==r?`url(#${r})`:"none"),o.setAttribute("stroke",null!==s?`url(#${s})`:"none");const i=x(t,e,"stroke-width",t.useElementContext);o.setAttribute("stroke-width",null!=i?i:"0"),d(t,e,o),y(t,r),y(t,s)}}function y(t,e){if(null===e)return;const n=g(t),r=`#${e}`;if(!n.querySelector(r)){const e=t.sourceSvg.querySelector(r);if(e){if(!t.sketchPatterns)return void n.appendChild(e.cloneNode(!0));const r=function(t,e,n){const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.appendChild(e);const s=Object.assign(Object.assign({},t),{sourceSvg:r,svgSketch:document.createElementNS("http://www.w3.org/2000/svg","svg"),roughConfig:Object.assign(Object.assign({},t.roughConfig),n)});return s.processElement(s,e,null),u(document.createElementNS("http://www.w3.org/2000/svg","g"),s.svgSketch)}(t,u(document.createElementNS("http://www.w3.org/2000/svg","g"),e.cloneNode(!0)),{fillStyle:"solid",roughness:.5}),s=e.cloneNode();n.appendChild(u(s,r))}}}const w=/^([+-]?(?:\d+|\d*\.\d+(?:[eE][+-]?\d+)?))([a-z]*|%)$/,S={in:96,cm:96/2.54,mm:96/25.4,pt:96/72,pc:16,px:1},V=Math.sqrt(2);function E(t,e,n,r){const{value:s,unit:o}=C(n);return function(t){return!!S[t]}(o)?function(t,e){var n;const r=null!==(n=S[e])&&void 0!==n?n:1;return t*r}(s,o):function(t,e,n,r,s){var o;const i=null!==(o=t.viewBox)&&void 0!==o?o:{w:0,h:0};if("%"===s)return function(t,e,{w:n,h:r}={w:0,h:0}){const s=e/100;if("x"===t)return s*n;if("y"===t)return s*r;return s*(Math.sqrt(n*n+r*r)/V)}(n,r,i);if("vw"===s||"vh"===s||"vmin"===s||"vmax"===s)return function(t,e,{w:n,h:r}={w:0,h:0}){var s,o;const i=t/100,a=null!==(s=window.innerWidth)&&void 0!==s?s:n,l=null!==(o=window.innerHeight)&&void 0!==o?o:r;if("vw"===e)return i*a;if("vh"===e)return i*l;if("vmin"===e)return i*Math.min(a,l);if("vmax"===e)return i*Math.max(a,l);throw new Error(`Not a viewport length unit: ${e}`)}(r,s,i);if("em"===s||"ex"===s||"ch"===s||"rem"===s)return function(t,e,n,r){var s;if("rem"===r){const t=document.documentElement,e=C(getComputedStyle(t).fontSize);return n*("px"===e.unit?e.value:16)}if("ch"===r){const t=function(t){const e=l(t);if(!e)return 1;const n=document.createElementNS("http://www.w3.org/2000/svg","text");n.style.visibility="hidden",n.appendChild(document.createTextNode("0")),e.appendChild(n);const r=n.getBBox();return e.removeChild(n),r.width}(e);return n*t}const o=null!==(s=x(t,e,"font-size",t.useElementContext))&&void 0!==s?s:"16px",i=C(o),a="px"===i.unit?i.value:16;if("em"===r)return n*a;if("ex"===r)return n*a*.5;throw new Error(`Not a font relative unit: ${r}`)}(t,e,r,s);throw new Error(`Unsupported relative length unit: ${s}`)}(t,e,r,s,o)}function C(t){const e=t.match(w);if(null===e||3!==e.length)throw new Error(`Cannot parse dimension: ${t}`);return{value:parseFloat(e[1]),unit:e[2].toLowerCase()||"px"}}function A(t){if(!t)return!0;const e=t.matrix;return!e||1===e.a&&0===e.b&&0===e.c&&1===e.d&&0===e.e&&0===e.f}function k(t){if(!t)return!0;const e=t.matrix;return!e||1===e.a&&0===e.b&&0===e.c&&1===e.d}function $(t,e){if(!e)return t;const n=e.matrix;return{x:n.a*t.x+n.c*t.y+n.e,y:n.b*t.x+n.d*t.y+n.f}}function N(t){return t.transform&&t.transform.baseVal.numberOfItems>0?t.transform.baseVal.consolidate():null}function M(t,e,n){if(!n)return N(e);const r=N(e);if(r){const e=r.matrix,s=n.matrix.multiply(e);return t.sourceSvg.createSVGTransformFromMatrix(s)}return n}function O(t,e,n){if(e&&e.matrix&&!A(e)){const t=e.matrix;n.transform.baseVal.numberOfItems>0?n.transform.baseVal.getItem(0).setMatrix(t):n.transform.baseVal.appendItem(e)}}function F(t){var n;let r=t.getAttribute("stop-color");if(!r){const e=null!==(n=t.getAttribute("style"))&&void 0!==n?n:"",s=/stop-color:\s?(.*);?/.exec(e);s&&s.length>1&&(r=s[1])}return e(r||"white")}function T(t){const n=t.length;let r=0,s=0,o=0,i=0;return t.forEach((t=>{const e=t.toRgb();r+=e.r*e.r,s+=e.g*e.g,o+=e.b*e.b,i+=e.a})),e({r:Math.sqrt(r/n),g:Math.sqrt(s/n),b:Math.sqrt(o/n),a:i/n})}function G(t){const e=t.getAttribute("offset");return e?e.indexOf("%")?parseFloat(e.substring(0,e.length-1)):100*parseFloat(e):0}function z(t,e){if("solid"===t.roughConfig.fillStyle)return{angle:0,gap:0,weight:0};const{width:n,height:r}=e.getBoundingClientRect(),s=n/r,o=Math.sqrt(n*r),{angle:i,gap:a,weight:l}=function(t){const e={angle:{normal:[-30,-50],horizontal:[-30,-50],vertical:[-30,-50]},weight:{normal:[.5,3],small:[.5,3]},gap:{normal:[3,5],small:[3,5]}},n={angle:{normal:[-30,-50],horizontal:[-50,-75],vertical:[-30,-15]},weight:{normal:[1,3],small:[.5,1.7]},gap:{normal:[2,5],small:[1,3]}};switch(t){default:return n;case"zigzag":case"zigzag-line":return Object.assign(Object.assign({},n),{weight:{normal:[.5,3],small:[.5,2]},gap:{normal:[2,6],small:[2,5]}});case"cross-hatch":return Object.assign(Object.assign({},n),{weight:{normal:[1,3],small:[.5,1.3]},gap:{normal:[4,8],small:[2,5]}});case"dots":return e}}(t.roughConfig.fillStyle);return{angle:j(t,i,s),gap:I(t,a,o),weight:P(t,l,o)}}function j({rng:t},{normal:e,horizontal:n,vertical:r},s){if(isFinite(s)){if(s<.25)return t.next(n);if(s>6)return t.next(r)}return t.next(e)}function I({rng:t},{normal:e,small:n},r){return r<45?t.next(n):t.next(e)}function P({rng:t},{normal:e,small:n},r){return r<45?t.next(n):t.next(e)}function R(t,n,r){var s;const o=null!==(s=t.roughConfig.fixedDecimalPlaceDigits)&&void 0!==s?s:15,i=Object.assign({},t.roughConfig);let a=1;if(!A(r)){const t=r.matrix,e=t.a*t.d-t.c*t.b;a=Math.sqrt(Math.abs(e))}const l=b(t,n,1,t.useElementContext),u=x(t,n,"fill",t.useElementContext)||"black",c=l*L(n,"fill-opacity");if(u)if(-1!==u.indexOf("url")){const e=B(t,u,c);"none"!==e?i.fill=e:delete i.fill}else if("none"===u)delete i.fill;else{const t=e(u);t.setAlpha(c),i.fill=t.toString()}const h=x(t,n,"stroke",t.useElementContext),f=l*L(n,"stroke-opacity");if(h)if(-1!==h.indexOf("url"))i.stroke=B(t,h,f);else if("none"===h)i.stroke="none";else{const t=e(h);t.setAlpha(f),i.stroke=t.toString()}else i.stroke="none";const g=x(t,n,"stroke-width",t.useElementContext);if(g){const e=E(t,n,g,"stroke-width")*a;i.strokeWidth=parseFloat(e.toFixed(o))}else i.strokeWidth=1;const m=x(t,n,"stroke-dasharray",t.useElementContext);m&&"none"!==m&&(i.strokeLineDash=m.split(/[\s,]+/).filter((t=>t.length>0)).map((e=>{const r=E(t,n,e,"stroke-dasharray")*a;return Math.max(.5,parseFloat(r.toFixed(o)))})));const d=x(t,n,"stroke-dashoffset",t.useElementContext);if(d){const e=E(t,n,d,"stroke-dashoffset")*a;i.strokeLineDashOffset=parseFloat(e.toFixed(o))}if(i.fill&&"none"===i.stroke&&(i.stroke=i.fill,i.strokeWidth=1),t.randomize){const{angle:e,gap:r,weight:s}=z(t,n);i.hachureAngle=e,i.hachureGap=Math.round(r),i.fillWeight=parseFloat(s.toFixed(o)),void 0===i.disableMultiStroke&&(i.disableMultiStroke=t.rng.next()>.3)}return i}function L(t,e){const n=getComputedStyle(t)[e]||t.getAttribute(e);return n?-1!==n.indexOf("%")?Math.min(1,Math.max(0,parseFloat(n.substring(0,n.length-1))/100)):Math.min(1,Math.max(0,parseFloat(n))):1}function B(t,e,n){const r=c(e);if(!r)return"none";const s=t.idElements[r];if(!s)return"none";if("string"==typeof s)return s;if(s instanceof SVGLinearGradientElement||s instanceof SVGRadialGradientElement){const e=function(t,e){const n=Array.prototype.slice.apply(t.querySelectorAll("stop"));if(0===n.length)return"transparent";if(1===n.length){const t=F(n[0]);return t.setAlpha(e),t.toString()}{const t=10,r=[];let s=null;for(let e=0;e<n.length;e++){const o=F(n[e]),i=G(n[e]),a=s?T([s,o]):o;let l=Math.max(1,i/t|0);for(;l>0;)r.push(a),l--;s=o}const o=T(r);return o.setAlpha(e),o.toString()}}(s,n);return t.idElements[r]=e,e}return"none"}function D(t){return`${t.x},${t.y}`}function _(t,e,n,r){if(0===n.length)return;const s=n[0],o=n[n.length-1],i=c(e.getAttribute("marker-start")),a=i?t.idElements[i]:null;if(a&&n.length>1){let i=a.orientAngle.baseVal.value;const l=n[1],u=a.getAttribute("orient");if("auto"===u||"auto-start-reverse"===u){const t="auto"===u?0:180,e=n[n.length-2];if(W(n))i=H(e,o,l)-t;else{i=U({x:1,y:0},{x:l.x-s.x,y:l.y-s.y})-t}}const c=t.sourceSvg.createSVGMatrix().translate(s.x,s.y).rotate(i).scale(q(t,a,e)),h=r?r.matrix.multiply(c):c,f=t.sourceSvg.createSVGTransformFromMatrix(h);t.processElement(t,a,f)}const l=c(e.getAttribute("marker-end")),u=l?t.idElements[l]:null;if(u){let s=u.orientAngle.baseVal.value;if(n.length>1){const t=u.getAttribute("orient");if("auto"===t||"auto-start-reverse"===t){const t=n[n.length-2];if(W(n)){s=H(t,o,n[1])}else{s=U({x:1,y:0},{x:o.x-t.x,y:o.y-t.y})}}}const i=t.sourceSvg.createSVGMatrix().translate(o.x,o.y).rotate(s).scale(q(t,u,e)),a=r?r.matrix.multiply(i):i,l=t.sourceSvg.createSVGTransformFromMatrix(a);t.processElement(t,u,l)}const h=c(e.getAttribute("marker-mid")),f=h?t.idElements[h]:null;if(f&&n.length>2)for(let s=0;s<n.length;s++){const o=n[s];if(0===s||s===n.length-1)continue;let i=f.orientAngle.baseVal.value;const a=f.getAttribute("orient");if("auto"===a||"auto-start-reverse"===a){i=H(n[s-1],o,n[s+1])}const l=t.sourceSvg.createSVGMatrix().translate(o.x,o.y).rotate(i).scale(q(t,f,e)),u=r?r.matrix.multiply(l):l,c=t.sourceSvg.createSVGTransformFromMatrix(u);t.processElement(t,f,c)}}function q(t,e,n){const r=e.getAttribute("markerUnits");let s=1;if(!r||"strokeWidth"===r){const e=x(t,n,"stroke-width");e&&(s=E(t,n,e,"stroke-width"))}return s}function W(t){return e=t[0],n=t[t.length-1],e.x===n.x&&e.y===n.y;var e,n}function H(t,e,n){const r={x:n.x-e.x,y:n.y-e.y},s=U(r,{x:t.x-e.x,y:t.y-e.y}),o=e.x+1,i=e.y,a=U(r,{x:o-e.x,y:i-e.y});return((l=s)-180*Math.sign(l))/2-a;var l}function U(t,e){const n=Math.atan2(t.y,t.x),r=Math.atan2(e.y,e.x)-n,s=-Math.sign(r)*Math.PI*2,o=Math.abs(s+r)<Math.abs(r)?s+r:r;return Math.round(360*o/(2*Math.PI))}function Z(t,e,{x:n,y:r,w:s,h:o}){v(t,e,(()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","rect");return t.x.baseVal.value=n,t.y.baseVal.value=r,t.width.baseVal.value=s,t.height.baseVal.value=o,t}))}function X(t,e,n,r){const s=c(n);if(!s)return;const o=t.idElements[s];if(!o)return;const i=g(t),l=`${s}_${i.childElementCount}`,u=document.createElementNS("http://www.w3.org/2000/svg","clipPath");u.id=l,function(t,e){if("g"!==t.tagName)return void t.setAttribute(h,e);const n=[],r=a(t);for(let t=r.length-1;t>=0;t--)n.push(r[t]);for(;n.length>0;){const t=n.pop();t.setAttribute(h,e);const r=a(t);for(let t=r.length-1;t>=0;t--)n.push(r[t])}}(e,l);const f=[],m=a(o);for(let e=m.length-1;e>=0;e--){const n=m[e],s=M(t,n,r);f.push({element:n,transform:s})}for(;f.length>0;){const{element:e,transform:n}=f.pop();try{Q(t,e,u,n)}catch(t){console.error(t)}if("defs"===e.tagName||"svg"===e.tagName||"clipPath"===e.tagName||"text"===e.tagName)continue;const r=a(e);for(let e=r.length-1;e>=0;e--){const s=r[e],o=M(t,s,n);f.push({element:s,transform:o})}}u.childNodes.length>0&&i.appendChild(u)}function Q(t,e,n,r){switch(e.tagName){case"rect":!function(t,e,n,r){const s=e.x.baseVal.value,o=e.y.baseVal.value,i=e.width.baseVal.value,a=e.height.baseVal.value;if(0===i||0===a)return;const l=e.hasAttribute("rx")?e.rx.baseVal.value:null,u=e.hasAttribute("ry")?e.ry.baseVal.value:null,c=document.createElementNS("http://www.w3.org/2000/svg","rect");c.x.baseVal.value=s,c.y.baseVal.value=o,c.width.baseVal.value=i,c.height.baseVal.value=a,l&&(c.rx.baseVal.value=l),u&&(c.ry.baseVal.value=u),O(0,r,c),n.appendChild(c)}(0,e,n,r);break;case"circle":!function(t,e,n,r){const s=e.cx.baseVal.value,o=e.cy.baseVal.value,i=e.r.baseVal.value;if(0===i)return;const a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.cx.baseVal.value=s,a.cy.baseVal.value=o,a.r.baseVal.value=i,O(0,r,a),n.appendChild(a)}(0,e,n,r);break;case"ellipse":!function(t,e,n,r){const s=e.cx.baseVal.value,o=e.cy.baseVal.value,i=e.rx.baseVal.value,a=e.ry.baseVal.value;if(0===i||0===a)return;const l=document.createElementNS("http://www.w3.org/2000/svg","ellipse");l.cx.baseVal.value=s,l.cy.baseVal.value=o,l.rx.baseVal.value=i,l.ry.baseVal.value=a,O(0,r,l),n.appendChild(l)}(0,e,n,r);break;case"polygon":!function(t,e,n,r){const s=document.createElementNS("http://www.w3.org/2000/svg","polygon");s.setAttribute("points",e.getAttribute("points")),O(0,r,s),n.appendChild(s)}(0,e,n,r);break;case"path":!function(t,e,n,r){const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",e.getAttribute("d")),O(0,r,s),n.appendChild(s)}(0,e,n,r)}}function Y(t,e,n){const r=document.createElementNS("http://www.w3.org/2000/svg","g");r.setAttribute("class","text-container"),O(0,n,r);const s=e.cloneNode(!0);s.transform.baseVal.numberOfItems>0&&s.transform.baseVal.clear(),s.removeAttribute("clip-path");const{cssFont:o,fontSize:i}=function(t,e,n=!1){const r={};let s="";const o=x(t,e,"font-style",t.useElementContext);o&&(s+=n?`font-style: ${o};`:o,r.fontStyle=o);const i=x(t,e,"font-weight",t.useElementContext);i&&(s+=n?`font-weight: ${i};`:` ${i}`,r.fontWeight=i);const a=x(t,e,"font-size",t.useElementContext);a&&(s+=n?`font-size: ${a};`:` ${a}`,r.fontSize=a);if(t.fontFamily)s+=n?`font-family: ${t.fontFamily};`:` ${t.fontFamily}`,r.fontFamiliy=t.fontFamily;else{const o=x(t,e,"font-family",t.useElementContext);o&&(s+=n?`font-family: ${o};`:` ${o}`,r.fontFamiliy=o)}return s=s.trim(),Object.assign(Object.assign({},r),{cssFont:s})}(t,e,!0);if(s.setAttribute("style",function(...t){let e="";t=t.filter((t=>null!==t));for(const n of t)e.length>0&&";"!==e[e.length-1]&&(e+=";"),e+=n;return e}(s.getAttribute("style"),o)),K(t,e,s),s.childElementCount>0){const n=a(s),r=a(e);for(let e=0;e<n.length;e++){const s=n[e];s instanceof SVGTSpanElement&&K(t,r[e],s)}}r.appendChild(s),d(t,e,r);const l=null!==t.fontFamily,u=s.hasAttribute(h);l&&u&&i&&function(t,e,n,r){const{width:s,height:o}=e.getBBox();if(s<=0||o<=0)return;const i=E(t,n,r,"font-size");J(t,{w:s,h:o},n,i)}(t,e,s,i)}function J(t,e,n,r){const{w:s}=function({svgSketch:t,svgSketchIsInDOM:e},n){const r="visibility:hidden;position:absolute;left:-100%;top-100%;",s=t.getAttribute("style");s?t.setAttribute("style",`${s};${r}`):t.setAttribute("style",r);const o=document.body,i=t.parentElement;e||o.appendChild(t);const{width:a,height:l}=n.getBBox();return e||(o.removeChild(t),i&&i.appendChild(t)),s?t.setAttribute("style",s):t.removeAttribute("style"),{w:a,h:l}}(t,n);if(s<e.w)return;if(r<=1)return;const o=r-1;n.style.fontSize=`${o}px`,J(t,e,n,o)}function K(t,e,n){const r=x(t,e,"stroke"),s=r?x(t,e,"stroke-width"):null,o=x(t,e,"fill"),i=x(t,e,"dominant-baseline"),a=x(t,e,"text-anchor",t.useElementContext);r&&n.setAttribute("stroke",r),s&&n.setAttribute("stroke-width",s),o&&n.setAttribute("fill",o),a&&n.setAttribute("text-anchor",a),i&&n.setAttribute("dominant-baseline",i)}function tt(t,e,n,r,s){var o,i;const l=[],u={x:0,y:0,w:null!=r?r:0,h:null!=s?s:0};if(e instanceof SVGSVGElement||e instanceof SVGSymbolElement||e instanceof SVGMarkerElement){let c=0,h=0;if(e instanceof SVGSymbolElement)c=parseFloat(null!==(o=e.getAttribute("x"))&&void 0!==o?o:"")||0,h=parseFloat(null!==(i=e.getAttribute("y"))&&void 0!==i?i:"")||0,r=null!=r?r:parseFloat(e.getAttribute("width"))||void 0,s=null!=s?s:parseFloat(e.getAttribute("height"))||void 0;else if(e instanceof SVGMarkerElement){const t=e.getAttribute("markerWidth"),n=e.getAttribute("markerHeight");r=null!==t?parseFloat(t):3,s=null!==n?parseFloat(n):3}else e!==t.sourceSvg&&(c=e.x.baseVal.value,h=e.y.baseVal.value);let f=t.sourceSvg.createSVGMatrix();if(e.getAttribute("viewBox")){const{x:t,y:n,width:o,height:i}=e.viewBox.baseVal;if(u.x=t,u.y=n,u.w=o,u.h=i,void 0!==r&&void 0!==s){const a=r/o,l=s/i,u=c+.5*r,g=h+.5*s,m=t+.5*o,d=n+.5*i;f=f.translate(u,g),f="none"===e.getAttribute("preserveAspectRatio")?f.scaleNonUniform(a,l):f.scale(Math.min(a,l)),f=f.translate(-m,-d)}}else f=f.translate(c,h);e instanceof SVGMarkerElement&&(f=f.translate(-e.refX.baseVal.value,-e.refY.baseVal.value));const g=n?n.matrix.multiply(f):f;n=t.sourceSvg.createSVGTransformFromMatrix(g);const m=a(e);for(let e=m.length-1;e>=0;e--){const r=m[e];if(r instanceof SVGSymbolElement||r instanceof SVGMarkerElement)continue;const s=M(t,r,n);l.push({element:r,transform:s,viewBox:u})}}else l.push({element:e,transform:n,viewBox:u});for(;l.length>0;){const{element:e,transform:n,viewBox:r}=l.pop();try{t.viewBox=r,et(t,e,n)}catch(t){console.error(t)}if("defs"===e.tagName||"symbol"===e.tagName||"marker"===e.tagName||"svg"===e.tagName||"clipPath"===e.tagName)continue;const s=a(e);for(let e=s.length-1;e>=0;e--){const o=s[e],i=M(t,o,n);l.push({element:o,transform:i,viewBox:r})}}}function et(t,e,o){if(function(t){const e=t.style;return!!e&&("none"===e.display||"hidden"===e.visibility)}(e))return;const i=e.getAttribute("clip-path");switch(i&&X(t,e,i,o),e.tagName){case"svg":case"symbol":!function(t,e,n){let r=parseFloat(e.getAttribute("width")),s=parseFloat(e.getAttribute("height"));(isNaN(r)||isNaN(s))&&(r=s=void 0),tt(t,e,n,r,s)}(t,e,o);break;case"rect":!function(t,e,n){const r=e.x.baseVal.value,s=e.y.baseVal.value,o=e.width.baseVal.value,i=e.height.baseVal.value;if(0===o||0===i)return;let a=e.hasAttribute("rx")?Math.min(Math.max(0,e.rx.baseVal.value),o/2):null,l=e.hasAttribute("ry")?Math.min(Math.max(0,e.ry.baseVal.value),i/2):null;null===a&&null===l||(a=null===a?l:a,l=null===l?a:l);const u=$({x:r,y:s},n),c=$({x:r+o,y:s+i},n),h=c.x-u.x,f=c.y-u.y,g={x:u.x,y:u.y,w:h,h:f};if(!A(n)&&!k(n)||a||l){let u="";if(null!==a&&null!==l){const t=4/3*(Math.sqrt(2)-1),e=$({x:r+a,y:s},n);u+=`M ${D(e)}`,u+=`L ${D($({x:r+o-a,y:s},n))}`;const c=$({x:r+o-a+t*a,y:s},n),h=$({x:r+o,y:s+t*l},n),f=$({x:r+o,y:s+l},n);u+=`C ${D(c)} ${D(h)} ${D(f)}`,u+=`L ${D($({x:r+o,y:s+i-l},n))}`;const g=$({x:r+o,y:s+i-l+t*l},n),m=$({x:r+o-t*a,y:s+i},n),d=$({x:r+o-a,y:s+i},n);u+=`C ${D(g)} ${D(m)} ${D(d)}`,u+=`L ${D($({x:r+a,y:s+i},n))}`;const p=$({x:r+a-t*a,y:s+i},n),x=$({x:r,y:s+i-t*l},n),b=$({x:r,y:s+i-l},n);u+=`C ${D(p)} ${D(x)} ${D(b)}`,u+=`L ${D($({x:r,y:s+l},n))}`;const v=$({x:r,y:s+t*l},n),y=$({x:r+t*a,y:s},n);u+=`C ${D(v)} ${D(y)} ${D(e)}`,u+="z"}else{const t=$({x:r,y:s},n),e=$({x:r+o,y:s},n),a=$({x:r+o,y:s+i},n),l=$({x:r,y:s+i},n);u+=`M ${D(t)}`,u+=`L ${D(e)}`,u+=`L ${D(a)}`,u+=`L ${D(l)}`,u+="z"}const c=p(t,u,R(t,e,n));Z(t,e,g),d(t,e,c)}else{const r=t.rc.rectangle(g.x,g.y,g.w,g.h,R(t,e,n));Z(t,e,g),d(t,e,r)}}(t,e,o);break;case"path":!function(t,e,o){const i=e.getAttribute("d"),a=new n(i).toAbs().transform(r.NORMALIZE_HVZ()).transform(r.NORMALIZE_ST()),l=new n(a.commands.map((t=>Object.assign({},t))));o&&l.transform(r.MATRIX(o.matrix.a,o.matrix.b,o.matrix.c,o.matrix.d,o.matrix.e,o.matrix.f));const u=s(l.commands);if(-1!==u.indexOf("undefined"))return void console.error("broken path data");const c=p(t,u,R(t,e,o));v(t,e,(()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",u),t})),d(t,e,c);const h=[];let f;a.commands.forEach((t=>{switch(t.type){case n.MOVE_TO:{const e={x:t.x,y:t.y};h.push(e),f=e;break}case n.LINE_TO:case n.QUAD_TO:case n.SMOOTH_QUAD_TO:case n.CURVE_TO:case n.SMOOTH_CURVE_TO:case n.ARC:h.push({x:t.x,y:t.y});break;case n.HORIZ_LINE_TO:h.push({x:t.x,y:0});break;case n.VERT_LINE_TO:h.push({x:0,y:t.y});break;case n.CLOSE_PATH:f&&h.push(f)}})),_(t,e,h,o)}(t,e,o);break;case"use":!function(t,e,n){let r=e.href.baseVal;r.startsWith("#")&&(r=r.substring(1));const s=t.idElements[r];if(s){let r,o;e.getAttribute("width")&&e.getAttribute("height")&&(r=e.width.baseVal.value,o=e.height.baseVal.value);const i=e.x.baseVal.value,a=e.y.baseVal.value;let l=t.sourceSvg.createSVGMatrix().translate(i,a);l=n?n.matrix.multiply(l):l;const u=t.sourceSvg.createSVGTransformFromMatrix(l);if(t.useElementContext){const n={root:e,referenced:s,parentContext:Object.assign({},t.useElementContext)};t.useElementContext=n}else t.useElementContext={root:e,referenced:s,parentContext:null};t.processElement(t,s,M(t,s,u),r,o),t.useElementContext.parentContext?t.useElementContext=t.useElementContext.parentContext:t.useElementContext=null}}(t,e,o);break;case"line":!function(t,e,n){const r={x:e.x1.baseVal.value,y:e.y1.baseVal.value},s={x:e.x2.baseVal.value,y:e.y2.baseVal.value},{x:o,y:i}=$(r,n),{x:a,y:l}=$(s,n);if(o===a&&i===l)return;const u=t.rc.line(o,i,a,l,R(t,e,n));v(t,e,(()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","line");return t.x1.baseVal.value=o,t.y1.baseVal.value=i,t.x2.baseVal.value=a,t.y2.baseVal.value=l,t})),d(t,e,u),_(t,e,[r,s],n)}(t,e,o);break;case"circle":!function(t,e,n){const r=e.cx.baseVal.value,s=e.cy.baseVal.value,o=e.r.baseVal.value;if(0===o)return;const i=$({x:r,y:s},n),a=$({x:r+o,y:s+o},n).x-i.x;let l;if(A(n)||k(n))l=t.rc.circle(i.x,i.y,2*a,Object.assign(Object.assign({},R(t,e,n)),{preserveVertices:!0}));else{const i=4/3*(Math.sqrt(2)-1),a=$({x:r+o,y:s},n),u=$({x:r,y:s+o},n),c=$({x:r-o,y:s},n),h=$({x:r,y:s-o},n),f=$({x:r+o,y:s+i*o},n),g=$({x:r+i*o,y:s+o},n),m=$({x:r-o,y:s+i*o},n),d=$({x:r-i*o,y:s-o},n),x=$({x:r+o,y:s-i*o},n);l=p(t,`M ${D(a)} C ${D(f)} ${D(g)} ${D(u)} S ${D(m)} ${D(c)} S ${D(d)} ${D(h)} S ${D(x)} ${D(a)}z`,R(t,e,n))}v(t,e,(()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","circle");return t.cx.baseVal.value=i.x,t.cy.baseVal.value=i.y,t.r.baseVal.value=a,t})),d(t,e,l)}(t,e,o);break;case"ellipse":!function(t,e,n){const r=e.cx.baseVal.value,s=e.cy.baseVal.value,o=e.rx.baseVal.value,i=e.ry.baseVal.value;if(0===o||0===i)return;const a=$({x:r,y:s},n),l=$({x:r+o,y:s+i},n),u=l.x-a.x,c=l.y-a.y;let h;if(A(n)||k(n))h=t.rc.ellipse(a.x,a.y,2*u,2*c,Object.assign(Object.assign({},R(t,e,n)),{preserveVertices:!0}));else{const a=4/3*(Math.sqrt(2)-1),l=$({x:r+o,y:s},n),u=$({x:r,y:s+i},n),c=$({x:r-o,y:s},n),f=$({x:r,y:s-i},n),g=$({x:r+o,y:s+a*i},n),m=$({x:r+a*o,y:s+i},n),d=$({x:r-o,y:s+a*i},n),x=$({x:r-a*o,y:s-i},n),b=$({x:r+o,y:s-a*i},n);h=p(t,`M ${D(l)} C ${D(g)} ${D(m)} ${D(u)} S ${D(d)} ${D(c)} S ${D(x)} ${D(f)} S ${D(b)} ${D(l)}z`,R(t,e,n))}v(t,e,(()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","ellipse");return t.cx.baseVal.value=a.x,t.cy.baseVal.value=a.y,t.rx.baseVal.value=u,t.ry.baseVal.value=c,t})),d(t,e,h)}(t,e,o);break;case"polyline":!function(t,e,n){const r=m(e),s=r.map((t=>{const e=$(t,n);return[e.x,e.y]})),o=R(t,e,n);if(v(t,e,(()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","polyline");return t.setAttribute("points",s.join(" ")),t})),o.fill&&"none"!==o.fill){const n=Object.assign(Object.assign({},o),{stroke:"none"});d(t,e,t.rc.polygon(s,n))}d(t,e,t.rc.linearPath(s,o)),_(t,e,r,n)}(t,e,o);break;case"polygon":!function(t,e,n){const r=m(e),s=r.map((t=>{const e=$(t,n);return[e.x,e.y]})),o=t.rc.polygon(s,R(t,e,n));v(t,e,(()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","polygon");return t.setAttribute("points",s.join(" ")),t})),d(t,e,o),r.length>0&&(r.push(r[0]),_(t,e,r,n))}(t,e,o);break;case"text":Y(t,e,o);break;case"image":!function(t,e,n){const r=e.href.baseVal,s=e.x.baseVal.value,o=e.y.baseVal.value;let i,a;if(e.getAttribute("width")&&e.getAttribute("height")&&(i=e.width.baseVal.value,a=e.height.baseVal.value),r.startsWith("data:")&&-1!==r.indexOf("image/svg+xml")){const e=/^data:([^,]*),(.*)/.exec(r);if(e&&e.length>2){const r=e[1];let l=e[2];const u=-1!==r.indexOf("base64"),c=-1!==r.indexOf("utf8");u&&(l=atob(l)),c||(l=decodeURIComponent(l));const h=(new DOMParser).parseFromString(l,"image/svg+xml").firstChild;let f=t.sourceSvg.createSVGMatrix().translate(s,o);f=n?n.matrix.multiply(f):f,t.processElement(t,h,t.sourceSvg.createSVGTransformFromMatrix(f),i,a)}}else{const r=e.cloneNode(),s=document.createElementNS("http://www.w3.org/2000/svg","g");O(0,n,s),s.appendChild(r),d(t,e,s)}}(t,e,o);break;case"foreignObject":!function(t,e,n){const r=e.cloneNode(!0),s=document.createElementNS("http://www.w3.org/2000/svg","g"),o=["color","font-family","font-size","font-style","font-variant","font-weight"],i=getComputedStyle(e);for(const t of o)s.style.setProperty(t,i.getPropertyValue(t));r.transform.baseVal.clear(),O(0,n,s),s.appendChild(r),d(t,r,s)}(t,e,o)}}class nt{constructor(t){this.rng=t?new o(t):null}next(t){var e,n;const r=null!==(n=null===(e=this.rng)||void 0===e?void 0:e.next())&&void 0!==n?n:Math.random();if(t){const e=t[0];return r*(t[1]-e)+e}return r}}class rt{set svg(t){this.$svg!==t&&(this.$svg=t,this.sourceSvgChanged())}get svg(){return this.$svg}set outputType(t){if(this.$outputType===t)return;if(t===i.CANVAS&&this.outputElement instanceof SVGSVGElement||t===i.SVG&&this.outputElement instanceof HTMLCanvasElement)throw new Error(`Output format ${t} incompatible with given output element ${this.outputElement.tagName}`);this.$outputType=t}get outputType(){return this.$outputType}set roughConfig(t){void 0===t.fixedDecimalPlaceDigits&&(t.fixedDecimalPlaceDigits=3),this.$roughConfig=t}get roughConfig(){return this.$roughConfig}constructor(t,e=i.SVG,n={}){if(this.backgroundColor=null,this.fontFamily="Comic Sans MS, cursive",this.randomize=!0,this.seed=null,this.sketchPatterns=!0,this.pencilFilter=!1,this.width=0,this.height=0,this.$roughConfig={},this.idElements={},this.lastResult=null,!t)throw new Error("No target provided");const r="string"==typeof t?document.querySelector(t):t;if(!r)throw new Error("Could not find target in document");this.roughConfig=n,this.outputElement=r,r instanceof HTMLCanvasElement?this.$outputType=i.CANVAS:r instanceof SVGSVGElement?this.$outputType=i.SVG:this.$outputType=e}sketch(t=!1){var e,n;if(!this.svg)return Promise.resolve(null);t&&this.sourceSvgChanged();const r=this.prepareRenderContainer(),s=this.createRenderContext(r);if(this.pencilFilter){g(s).appendChild(function(){const t=document.createElementNS("http://www.w3.org/2000/svg","filter");t.setAttribute("id","pencilTextureFilter"),t.setAttribute("x","0%"),t.setAttribute("y","0%"),t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("filterUnits","objectBoundingBox");const e=document.createElementNS("http://www.w3.org/2000/svg","feTurbulence");e.setAttribute("type","fractalNoise"),e.setAttribute("baseFrequency","2"),e.setAttribute("numOctaves","5"),e.setAttribute("stitchTiles","stitch"),e.setAttribute("result","f1"),t.appendChild(e);const n=document.createElementNS("http://www.w3.org/2000/svg","feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 -1.5 1.5"),n.setAttribute("result","f2"),t.appendChild(n);const r=document.createElementNS("http://www.w3.org/2000/svg","feComposite");return r.setAttribute("operator","in"),r.setAttribute("in","SourceGraphic"),r.setAttribute("in2","f2"),r.setAttribute("result","f3"),t.appendChild(r),t}())}if(s.processElement(s,this.svg,null,this.width,this.height),this.outputElement instanceof SVGSVGElement)return Promise.resolve(this.outputElement);if(this.outputElement instanceof HTMLCanvasElement)return this.drawToCanvas(s,this.outputElement);if(null===(n=null===(e=this.lastResult)||void 0===e?void 0:e.parentNode)||void 0===n||n.removeChild(this.lastResult),this.outputType===i.SVG){const t=s.svgSketch;return this.outputElement.appendChild(t),this.lastResult=t,Promise.resolve(t)}{const t=document.createElement("canvas");return this.outputElement.appendChild(t),this.lastResult=t,this.drawToCanvas(s,t)}}createRenderContext(e){if(!this.svg)throw new Error("No source SVG set yet.");let n=this.roughConfig;return null!==this.seed&&(n=Object.assign({seed:this.seed},n)),{rc:t.svg(e,{options:n}),roughConfig:this.roughConfig,fontFamily:this.fontFamily,pencilFilter:this.pencilFilter,randomize:this.randomize,rng:new nt(this.seed),sketchPatterns:this.sketchPatterns,idElements:this.idElements,sourceSvg:this.svg,svgSketch:e,svgSketchIsInDOM:document.body.contains(e),styleSheets:Array.from(this.svg.querySelectorAll("style")).map((t=>t.sheet)).filter((t=>null!==t)),processElement:tt}}drawToCanvas(t,e){e.width=this.width,e.height=this.height;const n=e.getContext("2d");return n.clearRect(0,0,this.width,this.height),new Promise((r=>{const s=(new XMLSerializer).serializeToString(t.svgSketch),o=new Image;o.onload=function(){n.drawImage(this,0,0),r(e)},o.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(s)}`}))}prepareRenderContainer(){let t,e;for(t=this.outputElement instanceof SVGSVGElement?this.outputElement:document.createElementNS("http://www.w3.org/2000/svg","svg"),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");t.firstChild;)t.removeChild(t.firstChild);return t.setAttribute("width",this.width.toString()),t.setAttribute("height",this.height.toString()),this.backgroundColor&&(e=document.createElementNS("http://www.w3.org/2000/svg","rect"),e.width.baseVal.value=this.width,e.height.baseVal.value=this.height,e.setAttribute("fill",this.backgroundColor),t.appendChild(e)),t.setAttribute("stroke-linecap","round"),t}sourceSvgChanged(){const t=this.$svg;if(t){const e=this.roughConfig.fixedDecimalPlaceDigits;this.width=parseFloat(this.coerceSize(t,"width",300).toFixed(e)),this.height=parseFloat(this.coerceSize(t,"height",150).toFixed(e)),this.collectElementsWithID()}}collectElementsWithID(){this.idElements={};const t=Array.prototype.slice.apply(this.svg.querySelectorAll("*[id]"));for(const e of t){const t=e.getAttribute("id");t&&(this.idElements[t]=e)}}coerceSize(t,e,n){let r=n;const s=t.hasAttribute("viewBox");return t.hasAttribute(e)?r=t[e].baseVal.unitType===SVGLength.SVG_LENGTHTYPE_PERCENTAGE&&s?t.viewBox.baseVal[e]:t[e].baseVal.value:s&&(r=t.viewBox.baseVal[e]),r}}export{i as OutputType,rt as Svg2Roughjs};
//# sourceMappingURL=svg2roughjs.es.min.js.map
